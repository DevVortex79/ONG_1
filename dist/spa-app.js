import{navigateTo,router}from"./spa-router.js";import{pages}from"./spa-pages.js";const appContent=document.getElementById("app-content"),loader=document.getElementById("page-loader");function showAlert(e,t="sucesso"){const a=document.querySelector(".alerta");a&&a.remove();const r=document.createElement("div");r.className=`alerta ${t}`,r.innerHTML=`<span class="badge">${"sucesso"===t?"✓ Sucesso":"✗ Erro"}</span>${e}`,document.body.appendChild(r),setTimeout(()=>r.remove(),3e3)}const validadores={nome:{validar:e=>!e||e.trim().length<3?"Nome deve ter pelo menos 3 caracteres":/^[a-zA-ZÀ-ÿ\s]+$/.test(e)?e.trim().split(/\s+/).length<2?"Digite nome e sobrenome":null:"Nome deve conter apenas letras"},cpf:{validar:e=>{const t=e.replace(/\D/g,"");if(11!==t.length)return"CPF deve ter 11 dígitos";if(/^(\d)\1{10}$/.test(t))return"CPF inválido";let a=0;for(let e=1;e<=9;e++)a+=parseInt(t.substring(e-1,e))*(11-e);let r=10*a%11;if(10!==r&&11!==r||(r=0),r!==parseInt(t.substring(9,10)))return"CPF inválido";a=0;for(let e=1;e<=10;e++)a+=parseInt(t.substring(e-1,e))*(12-e);return r=10*a%11,10!==r&&11!==r||(r=0),r!==parseInt(t.substring(10,11))?"CPF inválido":null},formatar:e=>e.replace(/\D/g,"").replace(/(\d{3})(\d{3})(\d{3})(\d{2})/,"$1.$2.$3-$4")},data:{validar:e=>{if(!e)return"Data de nascimento é obrigatória";const t=new Date(e),a=new Date;if(t>a)return"Data não pode ser futura";let r=a.getFullYear()-t.getFullYear();const o=a.getMonth(),n=t.getMonth();return(o<n||o===n&&a.getDate()<t.getDate())&&r--,r<16?"Você deve ter pelo menos 16 anos":r>100?"Verifique a data informada":null}},email:{validar:e=>{if(!e)return"E-mail é obrigatório";if(!/^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(e))return"E-mail inválido";return e.split("@")[0].length<3?"E-mail muito curto":null}},telefone:{validar:e=>{const t=e.replace(/\D/g,"");if(t.length<10||t.length>11)return"Telefone deve ter 10 ou 11 dígitos";if(11===t.length&&"9"!==t[2])return"Celular deve começar com 9";const a=parseInt(t.substring(0,2));return a<11||a>99?"DDD inválido":null},formatar:e=>{const t=e.replace(/\D/g,"");return 11===t.length?t.replace(/(\d{2})(\d{5})(\d{4})/,"($1) $2-$3"):10===t.length?t.replace(/(\d{2})(\d{4})(\d{4})/,"($1) $2-$3"):e}},endereco:{validar:e=>!e||e.trim().length<5?"Endereço deve ter pelo menos 5 caracteres":/\d/.test(e)?null:"Endereço deve conter número"},cep:{validar:e=>{const t=e.replace(/\D/g,"");return 8!==t.length?"CEP deve ter 8 dígitos":/^0{8}$/.test(t)?"CEP inválido":null},formatar:e=>e.replace(/\D/g,"").replace(/(\d{5})(\d{3})/,"$1-$2")},senha:{validar:e=>!e||e.length<6?"Senha deve ter pelo menos 6 caracteres":/[A-Z]/.test(e)?/[a-z]/.test(e)?/[0-9]/.test(e)?null:"Senha deve ter pelo menos 1 número":"Senha deve ter pelo menos 1 letra minúscula":"Senha deve ter pelo menos 1 letra maiúscula"}};function mostrarErro(e,t){const a=e.parentElement.querySelector(".erro-validacao");if(a&&a.remove(),e.classList.add("campo-invalido"),e.classList.remove("campo-valido"),t){const a=document.createElement("div");a.className="erro-validacao",a.textContent=t,e.parentElement.appendChild(a)}}function mostrarSucesso(e){const t=e.parentElement.querySelector(".erro-validacao");t&&t.remove(),e.classList.remove("campo-invalido"),e.classList.add("campo-valido")}function validarCampo(e){const t=e.id,a=e.value;if(!validadores[t])return!0;const r=validadores[t].validar(a);return r?(mostrarErro(e,r),!1):(mostrarSucesso(e),!0)}function aplicarMascara(e){const t=e.id;if(validadores[t]&&validadores[t].formatar){const a=validadores[t].formatar(e.value);a!==e.value&&(e.value=a)}}function handleCadastroForm(){const e=document.querySelector("form");if(!e)return;const t=["nome","cpf","data","email","telefone","endereco","cep","senha"];t.forEach(e=>{const t=document.getElementById(e);t&&(t.addEventListener("blur",()=>{t.value&&validarCampo(t)}),t.addEventListener("input",()=>{if(t.classList.contains("campo-invalido")){t.classList.remove("campo-invalido");const e=t.parentElement.querySelector(".erro-validacao");e&&e.remove()}aplicarMascara(t)}))}),e.addEventListener("submit",a=>{if(a.preventDefault(),!document.getElementById("termos").checked)return void showAlert("Você deve aceitar os termos de uso!","erro");let r=!0,o=null;if(t.forEach(e=>{const t=document.getElementById(e);if(t){validarCampo(t)||(r=!1,o||(o=t))}}),!r)return showAlert("Por favor, corrija os erros no formulário!","erro"),void(o&&(o.focus(),o.scrollIntoView({behavior:"smooth",block:"center"})));showAlert("Cadastro realizado com sucesso!","sucesso"),setTimeout(()=>{e.reset(),t.forEach(e=>{const t=document.getElementById(e);if(t){t.classList.remove("campo-valido","campo-invalido");const e=t.parentElement.querySelector(".erro-validacao");e&&e.remove()}})},1500)})}window.addEventListener("routechange",e=>{loader.classList.add("show"),setTimeout(()=>{appContent.innerHTML=pages[e.detail],loader.classList.remove("show"),appContent.setAttribute("tabindex","-1"),appContent.focus(),"cadastro"===e.detail&&handleCadastroForm()},400)}),document.addEventListener("click",e=>{const t=e.target.closest("[data-link]");t&&(e.preventDefault(),navigateTo(t.getAttribute("href")))}),window.addEventListener("popstate",router),document.addEventListener("DOMContentLoaded",router);